<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô - Google Drive Integration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .folder-card {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .folder-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }
        .file-card {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .file-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(240, 147, 251, 0.4);
        }
        .content-viewer {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .api-status {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        .demo-notice {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            animation: pulse 3s infinite;
        }
        .success-animation {
            animation: bounce 0.5s ease-in-out;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        .breadcrumb-item {
            transition: all 0.2s ease;
        }
        .breadcrumb-item:hover {
            background-color: rgba(59, 130, 246, 0.1);
            border-radius: 0.375rem;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen font-sans">
    <!-- Status Notice -->
    <div class="demo-notice text-white text-center py-3 px-4 text-sm font-medium">
        ‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô - ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Drive ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ã‡πâ‡∏≠‡∏ô + LINE app)
    </div>

    <div class="container mx-auto px-3 md:px-4 py-4 md:py-8">
        <!-- Header -->
        <div class="text-center mb-6 md:mb-8">
            <h1 class="text-2xl md:text-4xl lg:text-5xl font-bold text-gray-800 mb-2 md:mb-4">üóæ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô</h1>
            <p class="text-sm md:text-lg lg:text-xl text-gray-600 mb-4 px-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå‡∏à‡∏≤‡∏Å Google Drive</p>
            <div class="flex justify-center">
                <div id="connectionIndicator" class="flex items-center space-x-2 bg-white rounded-lg px-4 py-2 shadow-md">
                    <div id="statusDot" class="w-3 h-3 bg-red-500 rounded-full"></div>
                    <span id="statusText" class="text-sm text-gray-600">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</span>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="mb-4 md:mb-6">
            <nav class="flex flex-col md:flex-row md:items-center md:justify-between space-y-3 md:space-y-0">
                <div class="flex items-center space-x-2 text-sm md:text-lg">
                    <button id="homeBtn" class="text-blue-600 hover:text-blue-800 font-medium transition-colors">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
                    <div id="breadcrumb" class="flex items-center space-x-1 text-gray-500 text-xs md:text-sm overflow-x-auto"></div>
                </div>
                <div class="flex items-center space-x-2 md:space-x-3">
                    <div class="flex items-center space-x-2 bg-white rounded-lg px-2 md:px-3 py-2 shadow-md flex-1 md:flex-none">
                        <span class="text-xs md:text-sm text-gray-600 whitespace-nowrap">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°:</span>
                        <select id="sortSelect" class="text-xs md:text-sm bg-transparent border-none outline-none cursor-pointer">
                            <option value="name-asc">‡∏ä‡∏∑‡πà‡∏≠ (‡∏Å-‡∏Æ)</option>
                            <option value="name-desc">‡∏ä‡∏∑‡πà‡∏≠ (‡∏Æ-‡∏Å)</option>
                            <option value="type-asc">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Å‡πà‡∏≠‡∏ô)</option>
                            <option value="type-desc">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô)</option>
                        </select>
                    </div>
                    <button id="refreshBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-3 md:px-4 py-2 rounded-lg transition-colors font-medium text-xs md:text-sm whitespace-nowrap">
                        üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                    </button>
                </div>
            </nav>
        </div>

        <!-- Main Content Area - Full Width -->
        <div class="w-full">
            <div class="bg-white rounded-xl shadow-xl overflow-hidden">
                <div id="contentArea">
                    <div class="text-center py-8 md:py-16 px-4">
                        <div class="text-4xl md:text-6xl lg:text-8xl mb-4 md:mb-6">üóæ</div>
                        <h3 class="text-lg md:text-2xl lg:text-3xl font-bold text-gray-700 mb-3 md:mb-4">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô</h3>
                        <p class="text-sm md:text-lg lg:text-xl text-gray-600 mb-6 md:mb-8">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Drive ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</p>
                        <div class="bg-gradient-to-r from-blue-100 to-purple-100 border border-blue-200 rounded-xl p-4 md:p-6 max-w-lg mx-auto">
                            <h4 class="font-semibold text-blue-800 mb-3 text-sm md:text-base">üöÄ ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö</h4>
                            <ul class="text-xs md:text-sm text-blue-700 space-y-2 text-left">
                                <li>‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ã‡πâ‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô</li>
                                <li>‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏≥‡∏ó‡∏≤‡∏á Breadcrumb</li>
                                <li>‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô Google Drive ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á</li>
                                <li>‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö</li>
                                <li>‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration - API Key ‡πÅ‡∏•‡∏∞ Folder ID ‡∏ù‡∏±‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î
        const FOLDER_ID = '1iSopgAk1KTn4CYSxazXDkWpPgxez8KDv';
        const API_KEY = 'AIzaSyBQdl6uQIe1TofMO241KZG4ZVreHy9BbM8'; // API Key ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á
        let currentView = 'folders';
        let currentFolder = null;
        let isConnected = true; // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        let folderHistory = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå
        let currentFolderId = FOLDER_ID; // ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        let currentSortType = 'name-asc'; // ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        let currentFolders = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        let currentFiles = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

        // Mock data for demo with nested folders
        const mockData = {
            folders: {
                [FOLDER_ID]: [
                    {
                        id: 'folder1',
                        name: 'üè® ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡πÉ‡∏ô‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô',
                        mimeType: 'application/vnd.google-apps.folder'
                    },
                    {
                        id: 'folder2', 
                        name: 'üçú ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£',
                        mimeType: 'application/vnd.google-apps.folder'
                    },
                    {
                        id: 'folder3',
                        name: 'üöÖ ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏™‡πà‡∏á', 
                        mimeType: 'application/vnd.google-apps.folder'
                    },
                    {
                        id: 'folder4',
                        name: 'üõçÔ∏è ‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏á‡∏ù‡∏≤‡∏Å',
                        mimeType: 'application/vnd.google-apps.folder'
                    }
                ],
                folder1: [
                    {
                        id: 'subfolder1_1',
                        name: 'üèôÔ∏è ‡πÇ‡∏ï‡πÄ‡∏Å‡∏µ‡∏¢‡∏ß',
                        mimeType: 'application/vnd.google-apps.folder'
                    },
                    {
                        id: 'subfolder1_2',
                        name: 'üèØ ‡πÇ‡∏≠‡∏ã‡∏≤‡∏Å‡πâ‡∏≤',
                        mimeType: 'application/vnd.google-apps.folder'
                    },
                    {
                        id: 'subfolder1_3',
                        name: '‚õ©Ô∏è ‡πÄ‡∏Å‡∏µ‡∏¢‡∏ß‡πÇ‡∏ï',
                        mimeType: 'application/vnd.google-apps.folder'
                    }
                ],
                folder2: [
                    {
                        id: 'subfolder2_1',
                        name: 'üç£ ‡∏ã‡∏π‡∏ä‡∏¥‡πÅ‡∏•‡∏∞‡∏ã‡∏≤‡∏ä‡∏¥‡∏°‡∏¥',
                        mimeType: 'application/vnd.google-apps.folder'
                    },
                    {
                        id: 'subfolder2_2',
                        name: 'üçú ‡∏£‡∏≤‡πÄ‡∏°‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏î‡πâ‡∏á',
                        mimeType: 'application/vnd.google-apps.folder'
                    }
                ]
            },
            files: {
                subfolder1_1: [
                    { id: 'file1', name: '‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°‡πÇ‡∏ï‡πÄ‡∏Å‡∏µ‡∏¢‡∏ß‡∏™‡πÄ‡∏ï‡∏ä‡∏±‡πà‡∏ô.pdf', mimeType: 'application/pdf' },
                    { id: 'file2', name: '‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°‡∏ä‡∏¥‡∏ô‡∏à‡∏π‡∏Å‡∏∏.pdf', mimeType: 'application/pdf' },
                    { id: 'file3', name: '‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°‡∏ä‡∏¥‡∏ö‡∏π‡∏¢‡∏∞.pdf', mimeType: 'application/pdf' }
                ],
                subfolder1_2: [
                    { id: 'file4', name: '‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°‡πÇ‡∏≠‡∏ã‡∏≤‡∏Å‡πâ‡∏≤‡∏Ñ‡∏≤‡∏™‡πÄ‡∏ã‡∏¥‡∏•.pdf', mimeType: 'application/pdf' },
                    { id: 'file5', name: '‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°‡∏î‡∏≠‡∏ó‡∏°‡∏ö‡∏≠‡∏£‡∏¥.pdf', mimeType: 'application/pdf' }
                ],
                subfolder1_3: [
                    { id: 'file6', name: '‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°‡πÄ‡∏Å‡∏µ‡∏¢‡∏ß‡πÇ‡∏ï‡∏™‡πÄ‡∏ï‡∏ä‡∏±‡πà‡∏ô.pdf', mimeType: 'application/pdf' },
                    { id: 'file7', name: '‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡πÅ‡∏ö‡∏ö‡∏î‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏¥‡∏°.pdf', mimeType: 'application/pdf' }
                ],
                subfolder2_1: [
                    { id: 'file8', name: '‡∏£‡πâ‡∏≤‡∏ô‡∏ã‡∏π‡∏ä‡∏¥‡∏ä‡∏∑‡πà‡∏≠‡∏î‡∏±‡∏á.pdf', mimeType: 'application/pdf' },
                    { id: 'file9', name: '‡∏ï‡∏•‡∏≤‡∏î‡∏õ‡∏•‡∏≤‡∏™‡∏∂‡∏Å‡∏¥‡∏à‡∏¥.pdf', mimeType: 'application/pdf' }
                ],
                subfolder2_2: [
                    { id: 'file10', name: '‡∏£‡πâ‡∏≤‡∏ô‡∏£‡∏≤‡πÄ‡∏°‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥.pdf', mimeType: 'application/pdf' },
                    { id: 'file11', name: '‡∏≠‡∏∏‡∏î‡πâ‡∏á‡πÇ‡∏Æ‡∏°‡πÄ‡∏°‡∏î.pdf', mimeType: 'application/pdf' }
                ],
                folder3: [
                    { id: 'file12', name: 'JR Pass ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠.pdf', mimeType: 'application/pdf' },
                    { id: 'file13', name: '‡∏£‡∏ñ‡πÑ‡∏ü‡πÉ‡∏ï‡πâ‡∏î‡∏¥‡∏ô.pdf', mimeType: 'application/pdf' },
                    { id: 'file14', name: '‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô.pdf', mimeType: 'application/pdf' }
                ],
                folder4: [
                    { id: 'file15', name: '‡∏´‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤.pdf', mimeType: 'application/pdf' },
                    { id: 'file16', name: '‡∏Ç‡∏≠‡∏á‡∏ù‡∏≤‡∏Å‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°.pdf', mimeType: 'application/pdf' }
                ]
            }
        };

        // Google Drive API Functions
        async function loadGoogleDriveFolders(folderId, apiKey) {
            try {
                const url = `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents+and+mimeType='application/vnd.google-apps.folder'&key=${apiKey}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                return data.files || [];
            } catch (error) {
                console.error('Error loading folders:', error);
                showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Drive ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API Key');
                return [];
            }
        }

        async function loadGoogleDriveFiles(folderId, apiKey) {
            try {
                const url = `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents+and+mimeType!='application/vnd.google-apps.folder'&fields=files(id,name,mimeType,webViewLink)&key=${apiKey}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                return data.files || [];
            } catch (error) {
                console.error('Error loading files:', error);
                return [];
            }
        }

        // UI Functions
        function showLoading(message = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...') {
            document.getElementById('contentArea').innerHTML = `
                <div class="text-center py-8 md:py-16 px-4">
                    <div class="loading-spinner text-4xl md:text-6xl mb-4">‚è≥</div>
                    <h3 class="text-lg md:text-2xl font-semibold text-gray-700 mb-2">${message}</h3>
                    <div class="bg-blue-100 rounded-lg p-3 md:p-4 max-w-md mx-auto">
                        <p class="text-xs md:text-sm text-blue-800">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</p>
                    </div>
                </div>
            `;
        }

        function showError(message) {
            document.getElementById('contentArea').innerHTML = `
                <div class="text-center py-8 md:py-16 px-4">
                    <div class="text-4xl md:text-6xl mb-4">‚ùå</div>
                    <h3 class="text-lg md:text-2xl font-semibold text-red-700 mb-4">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
                    <div class="bg-red-100 border border-red-400 rounded-lg p-3 md:p-4 max-w-lg mx-auto">
                        <p class="text-sm md:text-base text-red-800">${message}</p>
                    </div>
                </div>
            `;
        }

        function updateConnectionStatus(connected) {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            if (connected) {
                statusDot.className = 'w-3 h-3 bg-green-500 rounded-full';
                statusText.textContent = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
            } else {
                statusDot.className = 'w-3 h-3 bg-red-500 rounded-full';
                statusText.textContent = '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
            }
        }

        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.innerHTML = '';
            
            if (folderHistory.length > 0) {
                folderHistory.forEach((folder, index) => {
                    const separator = document.createElement('span');
                    separator.textContent = ' > ';
                    separator.className = 'text-gray-400';
                    breadcrumb.appendChild(separator);
                    
                    const item = document.createElement('button');
                    item.textContent = folder.name;
                    item.className = 'breadcrumb-item text-blue-600 hover:text-blue-800 px-2 py-1 transition-colors';
                    item.addEventListener('click', () => navigateToFolder(index));
                    breadcrumb.appendChild(item);
                });
            }
        }

        function navigateToFolder(historyIndex) {
            // ‡∏ï‡∏±‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏Å
            folderHistory = folderHistory.slice(0, historyIndex + 1);
            const targetFolder = folderHistory[historyIndex];
            currentFolderId = targetFolder.id;
            displayFolders(currentFolderId);
        }

        function goBack() {
            if (folderHistory.length > 0) {
                folderHistory.pop(); // ‡∏•‡∏ö‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏≠‡∏≠‡∏Å
                if (folderHistory.length > 0) {
                    const previousFolder = folderHistory[folderHistory.length - 1];
                    currentFolderId = previousFolder.id;
                } else {
                    currentFolderId = FOLDER_ID;
                }
                displayFolders(currentFolderId);
            }
        }

        function enterFolder(folder) {
            folderHistory.push(folder);
            currentFolderId = folder.id;
            displayFolders(folder.id);
        }

        function naturalSort(a, b, locale = 'th') {
            // ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏±‡∏ô
            const regex = /(\d+|\D+)/g;
            const aParts = a.match(regex) || [];
            const bParts = b.match(regex) || [];
            
            const maxLength = Math.max(aParts.length, bParts.length);
            
            for (let i = 0; i < maxLength; i++) {
                const aPart = aParts[i] || '';
                const bPart = bParts[i] || '';
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                const aIsNumber = /^\d+$/.test(aPart);
                const bIsNumber = /^\d+$/.test(bPart);
                
                if (aIsNumber && bIsNumber) {
                    // ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
                    const aNum = parseInt(aPart, 10);
                    const bNum = parseInt(bPart, 10);
                    if (aNum !== bNum) {
                        return aNum - bNum;
                    }
                } else if (aIsNumber && !bIsNumber) {
                    // ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
                    return -1;
                } else if (!aIsNumber && bIsNumber) {
                    // ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏°‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
                    return 1;
                } else {
                    // ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                    const comparison = aPart.localeCompare(bPart, locale, { 
                        numeric: true, 
                        sensitivity: 'base' 
                    });
                    if (comparison !== 0) {
                        return comparison;
                    }
                }
            }
            
            return 0;
        }

        function sortItems(folders, files, sortType) {
            let sortedFolders = [...folders];
            let sortedFiles = [...files];
            
            switch(sortType) {
                case 'name-asc':
                    sortedFolders.sort((a, b) => naturalSort(a.name, b.name, 'th'));
                    sortedFiles.sort((a, b) => naturalSort(a.name, b.name, 'th'));
                    break;
                case 'name-desc':
                    sortedFolders.sort((a, b) => naturalSort(b.name, a.name, 'th'));
                    sortedFiles.sort((a, b) => naturalSort(b.name, a.name, 'th'));
                    break;
                case 'type-asc':
                    // ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏ü‡∏•‡πå
                    return [...sortedFolders.sort((a, b) => naturalSort(a.name, b.name, 'th')), 
                            ...sortedFiles.sort((a, b) => naturalSort(a.name, b.name, 'th'))];
                case 'type-desc':
                    // ‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå
                    return [...sortedFiles.sort((a, b) => naturalSort(a.name, b.name, 'th')), 
                            ...sortedFolders.sort((a, b) => naturalSort(a.name, b.name, 'th'))];
            }
            
            return [...sortedFolders, ...sortedFiles];
        }

        async function displayFolders(folderId = FOLDER_ID) {
            currentView = 'folders';
            currentFolder = null;
            currentFolderId = folderId;
            
            // Update breadcrumb
            updateBreadcrumb();
            
            showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå...');
            
            let folders = [];
            let files = [];
            
            if (isConnected && API_KEY) {
                folders = await loadGoogleDriveFolders(folderId, API_KEY);
                files = await loadGoogleDriveFiles(folderId, API_KEY);
            } else {
                // Use mock data
                folders = mockData.folders[folderId] || [];
                files = mockData.files[folderId] || [];
            }

            // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            currentFolders = folders;
            currentFiles = files;

            // Show content in main panel only
            showFolderContent(folders, files);
        }

        function showFolderContent(folders, files) {
            const currentFolderName = folderHistory.length > 0 ? 
                folderHistory[folderHistory.length - 1].name : 
                '‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å';
            
            const currentFolderIcon = folderHistory.length > 0 ? 
                folderHistory[folderHistory.length - 1].name.split(' ')[0] : 
                'üóæ';

            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            const sortedItems = sortItems(folders, files, currentSortType);
            const sortedFolders = sortedItems.filter(item => item.mimeType === 'application/vnd.google-apps.folder');
            const sortedFiles = sortedItems.filter(item => item.mimeType !== 'application/vnd.google-apps.folder');

            document.getElementById('contentArea').innerHTML = `
                <!-- Header -->
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 md:p-6">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-3 md:space-y-0">
                        <div class="flex items-center space-x-3 md:space-x-4">
                            <div class="text-2xl md:text-3xl lg:text-4xl">${currentFolderIcon}</div>
                            <div>
                                <h3 class="text-lg md:text-xl lg:text-2xl font-bold">${currentFolderName}</h3>
                                <p class="text-blue-100 text-xs md:text-sm">
                                    ${folders.length > 0 ? `${folders.length} ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå` : ''}
                                    ${folders.length > 0 && files.length > 0 ? ', ' : ''}
                                    ${files.length > 0 ? `${files.length} ‡πÑ‡∏ü‡∏•‡πå` : ''}
                                    ${folders.length === 0 && files.length === 0 ? '‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ß‡πà‡∏≤‡∏á' : ''}
                                </p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 md:space-x-3">
                            ${folderHistory.length > 0 ? `
                                <button onclick="goBack()" 
                                        class="bg-white bg-opacity-20 hover:bg-opacity-30 px-3 md:px-4 py-2 rounded-lg transition-colors text-xs md:text-sm">
                                    ‚¨ÖÔ∏è ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                                </button>
                            ` : ''}
                            <button onclick="displayFolders('${FOLDER_ID}'); folderHistory = [];" 
                                    class="bg-white bg-opacity-20 hover:bg-opacity-30 px-3 md:px-4 py-2 rounded-lg transition-colors text-xs md:text-sm">
                                üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Content Grid -->
                <div class="p-4 md:p-6 lg:p-8">
                    ${folders.length === 0 && files.length === 0 ? `
                        <div class="text-center py-8 md:py-16 text-gray-500 px-4">
                            <div class="text-4xl md:text-6xl mb-4">üìÇ</div>
                            <h4 class="text-lg md:text-xl font-semibold mb-2">‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ß‡πà‡∏≤‡∏á</h4>
                            <p class="text-sm md:text-base">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ</p>
                        </div>
                    ` : `
                        <!-- Combined Grid for Folders and Files -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6">
                            ${currentSortType === 'type-desc' ? 
                                // ‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå
                                sortedFiles.map(file => `
                                    <div class="bg-gradient-to-br from-pink-100 to-purple-100 rounded-xl p-4 md:p-6 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer hover:scale-105 border border-pink-200 touch-manipulation select-none"
                                         onclick="openFile('${file.id}', '${file.name.replace(/'/g, '\\\'').replace(/"/g, '&quot;')}')" 
                                         ontouchstart="this.style.transform='scale(0.98)'" 
                                         ontouchend="this.style.transform='scale(1)'"
                                         style="min-height: 44px; -webkit-tap-highlight-color: transparent;">
                                        <div class="text-center pointer-events-none">
                                            <div class="text-3xl md:text-4xl lg:text-5xl mb-3 md:mb-4">üìÑ</div>
                                            <h5 class="font-semibold text-gray-800 mb-2 md:mb-3 text-sm md:text-base leading-tight">${file.name}</h5>
                                            <div class="flex items-center justify-center space-x-2 text-xs text-gray-600 mb-2 md:mb-3">
                                                <span>üîó</span>
                                                <span>Google Drive</span>
                                            </div>
                                            <div class="bg-pink-500 bg-opacity-20 rounded-lg py-2 px-3">
                                                <p class="text-xs text-pink-800 font-medium">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå</p>
                                            </div>
                                        </div>
                                    </div>
                                `).join('') +
                                sortedFolders.map(folder => `
                                    <div class="bg-gradient-to-br from-blue-100 to-indigo-100 rounded-xl p-4 md:p-6 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer hover:scale-105 border border-blue-200 touch-manipulation select-none"
                                         onclick="enterFolder({id: '${folder.id}', name: '${folder.name}', mimeType: '${folder.mimeType}'})"
                                         ontouchstart="this.style.transform='scale(0.98)'" 
                                         ontouchend="this.style.transform='scale(1)'"
                                         style="min-height: 44px; -webkit-tap-highlight-color: transparent;">
                                        <div class="text-center pointer-events-none">
                                            <div class="text-3xl md:text-4xl lg:text-5xl mb-3 md:mb-4">üìÅ</div>
                                            <h5 class="font-semibold text-gray-800 mb-2 md:mb-3 text-sm md:text-base leading-tight">${folder.name}</h5>
                                            <div class="bg-blue-500 bg-opacity-20 rounded-lg py-2 px-3">
                                                <p class="text-xs text-blue-800 font-medium">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')
                                :
                                // ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏ü‡∏•‡πå (default)
                                sortedFolders.map(folder => `
                                    <div class="bg-gradient-to-br from-blue-100 to-indigo-100 rounded-xl p-4 md:p-6 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer hover:scale-105 border border-blue-200 touch-manipulation select-none"
                                         onclick="enterFolder({id: '${folder.id}', name: '${folder.name}', mimeType: '${folder.mimeType}'})"
                                         ontouchstart="this.style.transform='scale(0.98)'" 
                                         ontouchend="this.style.transform='scale(1)'"
                                         style="min-height: 44px; -webkit-tap-highlight-color: transparent;">
                                        <div class="text-center pointer-events-none">
                                            <div class="text-3xl md:text-4xl lg:text-5xl mb-3 md:mb-4">üìÅ</div>
                                            <h5 class="font-semibold text-gray-800 mb-2 md:mb-3 text-sm md:text-base leading-tight">${folder.name}</h5>
                                            <div class="bg-blue-500 bg-opacity-20 rounded-lg py-2 px-3">
                                                <p class="text-xs text-blue-800 font-medium">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
                                            </div>
                                        </div>
                                    </div>
                                `).join('') +
                                sortedFiles.map(file => `
                                    <div class="bg-gradient-to-br from-pink-100 to-purple-100 rounded-xl p-4 md:p-6 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer hover:scale-105 border border-pink-200 touch-manipulation select-none"
                                         onclick="openFile('${file.id}', '${file.name.replace(/'/g, '\\\'').replace(/"/g, '&quot;')}')" 
                                         ontouchstart="this.style.transform='scale(0.98)'" 
                                         ontouchend="this.style.transform='scale(1)'"
                                         style="min-height: 44px; -webkit-tap-highlight-color: transparent;">
                                        <div class="text-center pointer-events-none">
                                            <div class="text-3xl md:text-4xl lg:text-5xl mb-3 md:mb-4">üìÑ</div>
                                            <h5 class="font-semibold text-gray-800 mb-2 md:mb-3 text-sm md:text-base leading-tight">${file.name}</h5>
                                            <div class="flex items-center justify-center space-x-2 text-xs text-gray-600 mb-2 md:mb-3">
                                                <span>üîó</span>
                                                <span>Google Drive</span>
                                            </div>
                                            <div class="bg-pink-500 bg-opacity-20 rounded-lg py-2 px-3">
                                                <p class="text-xs text-pink-800 font-medium">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå</p>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')
                            }
                        </div>
                    `}
                </div>
                
                <!-- Footer -->
                <div class="bg-gray-50 p-4 md:p-6 text-center border-t">
                    <p class="text-gray-600 text-xs md:text-sm">
                        üí° ${folders.length > 0 ? '‡∏Ñ‡∏•‡∏¥‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡∏π' : ''}
                        ${folders.length > 0 && files.length > 0 ? ' | ' : ''}
                        ${files.length > 0 ? '‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô Google Drive' : ''}
                    </p>
                </div>
            `;
        }

        function refreshData() {
            const refreshIcon = document.getElementById('refreshIcon');
            if (refreshIcon) {
                refreshIcon.style.animation = 'spin 1s linear infinite';
                
                setTimeout(() => {
                    refreshIcon.style.animation = '';
                    displayFolders(currentFolderId);
                }, 1000);
            }
        }

        // Function to detect mobile device
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                   (navigator.maxTouchPoints && navigator.maxTouchPoints > 2 && /MacIntel/.test(navigator.platform));
        }

        // Function to detect if running in LINE app
        function isInLineApp() {
            const userAgent = navigator.userAgent.toLowerCase();
            return userAgent.includes('line') || userAgent.includes('lineapp');
        }

        // --- START: NEW EMBEDDED VIEWER CODE ---

        /**
         * 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏ü‡∏•‡πå
         * ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß viewer
         */
        function openFile(fileId, fileName) {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ fileId ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
            if (!fileId) {
                showError('File ID ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ');
                return;
            }
            showFileViewer(fileId, fileName);
        }

        /**
         * 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ö‡∏ö‡∏ù‡∏±‡∏á (Embedded Viewer)
         */
        function showFileViewer(fileId, fileName) {
            const contentArea = document.getElementById('contentArea');
            const navArea = document.querySelector('nav');

            // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô navigation ‡πÅ‡∏•‡∏∞ header ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
            navArea.style.display = 'none';
            document.querySelector('.text-center.mb-6.md\\:mb-8').style.display = 'none';

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ù‡∏±‡∏á (embed)
            // ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ URL ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô iframe
            const embedUrl = `https://drive.google.com/file/d/${fileId}/preview`;

            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô contentArea ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß viewer
            contentArea.innerHTML = `
                <div class="file-viewer-container bg-gray-800 text-white p-2 md:p-4">
                    <div class="flex items-center justify-between mb-2">
                        <p class="text-sm font-semibold truncate px-2">${fileName}</p>
                        <button 
                            onclick="closeFileViewer()" 
                            class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                            ‡∏õ‡∏¥‡∏î
                        </button>
                    </div>
                    <iframe 
                        src="${embedUrl}" 
                        class="w-full h-[80vh] border-0 rounded-lg" 
                        allow="fullscreen">
                    </iframe>
                </div>
            `;
        }

        /**
         * 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß Viewer ‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå
         */
        function closeFileViewer() {
            const navArea = document.querySelector('nav');

            // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô navigation ‡πÅ‡∏•‡∏∞ header ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
            navArea.style.display = 'flex';
            document.querySelector('.text-center.mb-6.md\\:mb-8').style.display = 'block';

            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
            displayFolders(currentFolderId);
        }

        // --- END: NEW EMBEDDED VIEWER CODE ---

        
        // Function to show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            notification.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 10);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(full)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Function to copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß!', 'success');
            }).catch(() => {
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á');
            });
        }

        // Make functions globally available
        window.displayFolders = displayFolders;
        window.enterFolder = enterFolder;
        window.goBack = goBack;
        window.openFile = openFile;
        window.closeFileViewer = closeFileViewer;
        window.copyToClipboard = copyToClipboard;

        // Event listeners
        document.getElementById('homeBtn').addEventListener('click', () => {
            folderHistory = [];
            currentFolderId = FOLDER_ID;
            displayFolders(FOLDER_ID);
        });
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° refresh
        document.getElementById('refreshBtn').addEventListener('click', refreshData);

        // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö
        document.getElementById('sortSelect').addEventListener('change', (e) => {
            currentSortType = e.target.value;
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà
            showFolderContent(currentFolders, currentFiles);
        });

        // Initialize - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥
        updateConnectionStatus(true); // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        displayFolders();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9878c2ddc4e47328',t:'MTc1OTI4ODE2Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
